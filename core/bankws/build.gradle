configurations {
  jaxb
}

// TODO: better solution
task genJaxb {
  ext.sourcesDir = "${buildDir}/generated/jaxb"
  ext.classesDir = "${buildDir}/classes/jaxb"
  ext.schema = "http://localhost:4000/bankWS/banks.wsdl"

  outputs.dir classesDir

  doLast {
    project.ant {
      taskdef name: "xjc", classname: "com.sun.tools.xjc.XJCTask", classpath: configurations.jaxb.asPath
      mkdir(dir: sourcesDir)
      mkdir(dir: classesDir)

      xjc(destdir: sourcesDir, schema: schema, package: 'ru.afal.bi.core.bankws.wsdl') {
        arg(value: "-wsdl")
        produces(dir: sourcesDir, includes: "**/*.java")
      }

      javac(
        destdir: classesDir,
        source: 11,
        target: 11,
        debug: true,
        debugLevel: "lines,vars,source",
        includeantruntime: false,
        classpath: configurations.jaxb.asPath
      ) {
        src(path: sourcesDir)
        include(name: "**/*.java")
        include(name: "*.java")
      }

      copy(todir: classesDir) {
        fileset(dir: sourcesDir, erroronmissingdir: false) {
          exclude(name: "**/*.java")
        }
      }
    }
  }
}

dependencies {
  implementation project(':core:common')
  implementation project(':soap:business')

  implementation 'org.springframework.ws:spring-ws-core'

  implementation group: 'com.sun.xml.ws', name: 'jaxws-rt', version: '2.3.3'

  implementation group: 'wsdl4j', name: 'wsdl4j'
  implementation group: 'org.springframework.boot', name: 'spring-boot-starter-web-services'

  jaxb group: 'org.glassfish.jaxb', name: 'jaxb-xjc'
  api(files(genJaxb.classesDir).builtBy(genJaxb))
}
